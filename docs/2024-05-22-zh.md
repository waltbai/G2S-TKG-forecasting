- [1. 训练流程](#1-训练流程)
- [2. 四元组顺序](#2-四元组顺序)
- [3. 提示模板](#3-提示模板)
	- [3.1. 行内模板（Inline Template）](#31-行内模板inline-template)
	- [3.2. 问答模板（QA Template）](#32-问答模板qa-template)
- [4. 匿名化策略（Anonymize Strategies）](#4-匿名化策略anonymize-strategies)
	- [4.1. 全局策略（Global Strategy）](#41-全局策略global-strategy)
		- [4.1.1. 三元组要素](#411-三元组要素)
		- [4.1.2. 时间](#412-时间)
	- [4.2. 会话策略（Session Strategy）](#42-会话策略session-strategy)
		- [4.2.1. 三元组](#421-三元组)
		- [4.2.2. 时间](#422-时间)
	- [4.3. 三元组处理](#43-三元组处理)
	- [4.4. 时间处理](#44-时间处理)
- [5. 实名化策略（De-anonymize Strategies）](#5-实名化策略de-anonymize-strategies)
	- [5.1. 填充策略（Fill-in Strategy）](#51-填充策略fill-in-strategy)
	- [5.2. 映射策略（Mapping Strategy）](#52-映射策略mapping-strategy)

## 1. 训练流程
训练流程主要分为两个阶段:
- **匿名训练阶段（通用训练阶段）**  
在匿名训练阶段，事实中的要素被替换为匿名要素，从而使大模型可以联合不同数据学习通用模式。
- **实名训练阶段（专用训练阶段）**  
在实名训练阶段，匿名要素被恢复为实名要素，从而使大模型可以通过微调少量参数，以适配到特定数据集。

## 2. 四元组顺序
我们采用`t:[s,r,o]`的格式表示四元组。

## 3. 提示模板
本节将介绍所使用的提示模板。具体而言，我们探索了两种不同的模板，分别是行内模板和问答模板。

### 3.1. 行内模板（Inline Template）
行内模板将历史事实与查询写在一起，不作区分。例如：
```
...
t_i:[s_i,r_i,o_i]
...
t_q:[s_q,r_q,
```

### 3.2. 问答模板（QA Template）
问答模板使用特殊字符串分隔历史事实、查询和答案，且用特殊符号（"?"）填充答案实体位置。例如：
```
### History ###
...
t_i:[s_i,r_i,o_i]
...

### Query ###
t_q:[s_q,r_q,?]

### Answer ###

```

## 4. 匿名化策略（Anonymize Strategies）
本节将介绍匿名训练阶段所使用的匿名化策略。具体而言，我们探索了两种不同策略，分别是全局策略与会话策略。

### 4.1. 全局策略（Global Strategy）
全局策略将数据集中每个要素通过全局唯一的ID进行匿名化。

#### 4.1.1. 三元组要素
对于三元组要素（即实体与关系），全局策略使用数据集的全局实体ID与关系ID作为匿名要素名。例如，假如在某个数据集中，`China`的实体ID为`0`，`America`的实体ID为`1`，`make statement`的关系ID为`10`，那么三元组`[China, make statement, America]`将会被转换为`[0,10,1]`。

#### 4.1.2. 时间
对于时间要素，全局策略使用每个时间点到该数据集起始时间的时间步作为ID。例如，若某数据集的时间粒度为“天”，起始时间为`2024-01-01`，那么时间点`2024-01-03`对应的ID为`2`。

### 4.2. 会话策略（Session Strategy）
会话策略对于每个查询和对应的历史中的要素进行独立匿名化，此处将一个查询称为一个会话。

#### 4.2.1. 三元组
对于一个会话中出现的实体，可以通过随机/按照频数的策略进行排序，将其序号作为实体匿名要素名。同样地，可以采用相同策略对会话中的关系进行排序，将其序号作为关系匿名要素名。例如，若在某会话中实体`China`出现5次，`America`出现7次，按照频数匿名化，则`America`的匿名要素名为`0`，`China`的匿名要素名为`1`。对于关系同理。

#### 4.2.2. 时间
在会话策略中，由于会话是以查询为基准向过去查询历史事实，应当以查询时间作为基准。例如，若查询时间为`2024-01-03`，则时间要素`2024-01-01`的匿名要素名为`2`。

### 4.3. 三元组处理
为将匿名三元组要素与常规数字进行区分，我们在实体、关系的匿名化的ID前分别添加了特定的前缀，从而组成匿名要素名。例如，`China`的实体ID为`0`，`America`的实体ID为`1`，`make statement`的关系ID为`10`，那么三元组`[China, make statement, America]`将会被转换为`[ENT_0,REL_10,ENT_1]`。在两种策略中，都可以进行该处理。

### 4.4. 时间处理
为将匿名时间要素与常规数字进行区分，在全局策略中，我们在时间后添加序数后缀与时间粒度。例如，若时间粒度为“天”，则时间ID`2`所对应的匿名要素名为`2nd day`。

在会话策略中，我们在时间后添加时间粒度与“ago”。例如，若时间粒度为“天”，则时间ID`2`所对应的匿名要素名为`2 days ago`。

**模糊时间段**：在会话策略中，一个可能的选项是对时间段采用模糊化的处理，例如将`8 days ago`转换为`a week ago`等。

## 5. 实名化策略（De-anonymize Strategies）
本节将介绍实名训练阶段所使用的实名化策略。具体而言，我们探索了两种不同策略，分别是填充策略与映射策略。

### 5.1. 填充策略（Fill-in Strategy）
填充策略将实名要素直接替换对应匿名要素。例如一段匿名化的会话：
```
...
1:[0,10,1]
...
```
将直接被替换为：
```
1: [China,make statement,America]
```

### 5.2. 映射策略（Mapping Strategy）
映射策略保留匿名化的会话，但是额外给出了匿名要素名与实名要素名之间的映射关系。例如一段匿名化的会话：
```
...
1: [0,10,1]
...
```
将会变换为：
```
...
1:[0,10,1]
...
### Entity Mapping ###
0:China, 1:America

### Relation Mapping ###
10:make statement
...
```
